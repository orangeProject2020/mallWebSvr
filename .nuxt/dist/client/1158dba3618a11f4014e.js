(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{361:function(t,e,r){"use strict";r.r(e);r(80),r(38),r(27),r(17),r(63),r(64),r(83),r(28);var n=r(47),c=r(195),o=r(196),l=r(325);function h(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}var m={head:function(){return{title:"购物车"}},data:function(){return{isLoading:!1,items:[],result:[],checkAllVal:!1,total:0,submitLoading:!1}},methods:function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?h(source,!0).forEach((function(e){Object(n.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):h(source).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}({},o.a,{onRefresh:function(){return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,regeneratorRuntime.awrap(this.getCartItems());case 3:this.$toast.success("刷新成功"),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),this.$toast.fail("刷新失败，请稍后重试");case 9:this.isLoading=!1;case 10:case"end":return t.stop()}}),null,this,[[0,6]])},navBack:function(){this.$store.state.isApp?uni.navigateBack():this.$router.go(-1)},navHome:function(){this.$store.state.isApp?uni.switchTab({url:"/pages/mall/index"}):this.$router.replace("/list")},getCartItems:function(){var t,e;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!this.$store.state.isApp){r.next=7;break}t=l.a.cartItems(),console.log("/getCartItems",t),this.items=t,r.next=12;break;case 7:return r.next=9,regeneratorRuntime.awrap(c.a.cartItems());case 9:e=r.sent,console.log("/getCartItems",e),this.items=e;case 12:this.getTotal(),r.next=18;break;case 15:r.prev=15,r.t0=r.catch(0),this.$toast.fail("获取购物车信息失败，请稍后刷新重试");case 18:case"end":return r.stop()}}),null,this,[[0,15]])},clearCart:function(){var t,e;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!this.$store.state.isApp){r.next=7;break}t=l.a.cartClear(),console.log("/getCartItems",t),this.items=t,r.next=12;break;case 7:return r.next=9,regeneratorRuntime.awrap(c.a.cartClear());case 9:e=r.sent,console.log("/getCartItems",e),this.items=e;case 12:this.getTotal(),this.$toast.success("清空购物车成功"),r.next=19;break;case 16:r.prev=16,r.t0=r.catch(0),this.$toast.fail("获取购物车信息失败，请稍后刷新重试");case 19:case"end":return r.stop()}}),null,this,[[0,16]])},changeNum:function(t,e){var r,n;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(console.log("changeNum:",t,e),r=JSON.parse(e.name),n=this.items,!(r.num>t)){o.next=14;break}if(t=r.num-t,!this.$store.state.isApp){o.next=9;break}n=l.a.cartItemMinus(r,t),o.next=12;break;case 9:return o.next=11,regeneratorRuntime.awrap(c.a.cartItemMinus(r,t));case 11:n=o.sent;case 12:o.next=23;break;case 14:if(!(r.num<t)){o.next=23;break}if(t-=r.num,!this.$store.state.isApp){o.next=20;break}n=l.a.cartItemPlus(r,t),o.next=23;break;case 20:return o.next=22,regeneratorRuntime.awrap(c.a.cartItemPlus(r,t));case 22:n=o.sent;case 23:this.items=n,this.getTotal();case 25:case"end":return o.stop()}}),null,this)},checkItem:function(){console.log("/checkItem",this.result),this.result.length==this.items.length?this.checkAllVal=!0:this.checkAllVal=!1,this.getTotal()},checkAll:function(){var t=this;console.log("/checkAll",this.checkAllVal),this.checkAllVal?this.result=[]:(this.result=[],this.items.forEach((function(e){t.result.push(e.id)}))),this.getTotal()},getTotal:function(){var t=this,e=0;this.items.forEach((function(r){t.result.indexOf(r.id)>-1&&(e+=r.price*r.num)})),this.total=e},onSubmit:function(){var t,e,r,n;return regeneratorRuntime.async((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,regeneratorRuntime.awrap(c.a.authCheck());case 2:if(t=o.sent,console.log("/create retCheckAuth",JSON.stringify(t,null,2)),!t.code){o.next=7;break}return uni.navigateTo({url:"/pages/auth/login"}),o.abrupt("return");case 7:if(!(this.result.length<=0)){o.next=10;break}return this.$toast("请选择待提交商品"),o.abrupt("return");case 10:return this.submitLoading=!0,e=this.items,r=this.result,n=[],e.forEach((function(t){r.indexOf(t.id)>-1&&n.push(t)})),this.$store.commit("orderDatasSet",n),this.$router.push("/order/confirm"),this.submitLoading=!1,o.abrupt("return");case 19:case"end":return o.stop()}}),null,this)}}),created:function(){return regeneratorRuntime.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(this.getCartItems());case 2:case"end":return t.stop()}}),null,this)}},f=r(29),component=Object(f.a)(m,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("van-nav-bar",{attrs:{title:"购物车","left-text":"","left-arrow":"","right-text":"清空"},on:{"click-left":t.navBack}},[r("template",{slot:"right"},[r("van-icon",{staticClass:"pl-4",attrs:{name:"delete",size:"20"},on:{click:t.clearCart}}),t._v(" "),r("van-icon",{staticClass:"pl-4",attrs:{name:"wap-home-o",size:"20"},on:{click:t.navHome}})],1)],2),t._v(" "),r("van-pull-refresh",{on:{refresh:t.onRefresh},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[t.items.length>0?[r("div",[r("van-checkbox-group",{ref:"checkboxGroup",on:{change:t.checkItem},model:{value:t.result,callback:function(e){t.result=e},expression:"result"}},t._l(t.items,(function(e){return r("van-row",{key:e.id,staticClass:"border-b"},[r("van-col",{staticClass:"pl-8 pt-8",attrs:{span:"4"}},[r("van-checkbox",{attrs:{name:e.id}})],1),t._v(" "),r("van-col",{attrs:{span:"20"}},[r("van-card",{attrs:{title:e.title,desc:e.desc,price:t.formatPrice(e.price),thumb:e.cover}},[r("div",{attrs:{slot:"footer"},slot:"footer"},[r("van-stepper",{attrs:{min:0,integer:"",name:JSON.stringify(e)},on:{change:t.changeNum},model:{value:e.num,callback:function(r){t.$set(e,"num",r)},expression:"item.num"}})],1)])],1)],1)})),1)],1)]:t._e()],2),t._v(" "),r("van-submit-bar",{attrs:{price:t.total,"button-text":"结算",loading:t.submitLoading},on:{submit:t.onSubmit}},[r("van-checkbox",{staticClass:"pl-8",on:{click:t.checkAll},model:{value:t.checkAllVal,callback:function(e){t.checkAllVal=e},expression:"checkAllVal"}},[t._v("全选")]),t._v(" "),r("span",{attrs:{slot:"tip"},slot:"tip"})],1)],1)}),[],!1,null,null,null);e.default=component.exports}}]);